# MMO Pac-Man — ゲームデザインドキュメント v0.4

## 1. コンセプト

**ジャンル:** 協力型マルチプレイヤー 2D アクション
**プレイ人数:** 2〜100人（動的スケーリング）
**プラットフォーム:** Web ブラウザ（PC / モバイル）
**1ゲームの目標時間:** 15〜30分

### コアコンセプト
巨大な 2D 迷路マップ上で、複数のプレイヤーが Pac-Man を操作し、協力してマップ全域のドットを食べ尽くす。ゴーストは AI が操作し、時間経過とともに強化・増殖していく。全エリア制覇でゲームクリア。

### デザインの原則

1. **協力が自然に生まれる** — 明示的な指示なしに、状況から協力行動が誘発される設計
2. **少人数でも100人でも楽しい** — プレイヤー数に応じてマップとゴーストが動的に調整される
3. **終盤まで緊張感が持続する** — 制覇エリアが増えるほど維持コストが非線形に増大する
4. **部分的な達成感の連続** — エリア制覇による段階的な進捗が、ゲーム全体のモチベーションを維持する

---

## 2. マップ設計

### 2.1 マップ構造

マップは複数の **エリア（セクター）** で構成される。各エリアは従来の Pac-Man 1面分程度のサイズで、エリア間は通路で接続される。

```
マップ全体のイメージ:

    ┌───┐   ┌───┐   ┌───┐
    │ A ├───┤ B ├───┤ C │
    └─┬─┘   └─┬─┘   └─┬─┘
      │       │       │
    ┌─┴─┐   ┌─┴─┐   ┌─┴─┐
    │ D ├───┤ E ├───┤ F │
    └─┬─┘   └─┬─┘   └─┬─┘
      │       │       │
    ┌─┴─┐   ┌─┴─┐   ┌─┴─┐
    │ G ├───┤ H ├───┤ I │
    └───┘   └───┘   └───┘
```

### 2.2 動的マップスケーリング

**マップサイズはプレイヤー数に応じて自動調整される。** これがスケーラビリティの根幹。

| プレイヤー数 | エリア数 | マップ総ドット数（概算） | ゴースト初期数 |
|:---:|:---:|:---:|:---:|
| 2〜5 | 4 | 2,000 | 8 |
| 6〜15 | 9 | 4,500 | 20 |
| 16〜30 | 16 | 8,000 | 40 |
| 31〜60 | 25 | 12,500 | 65 |
| 61〜100 | 36 | 18,000 | 100 |

**スケーリングの基本方針:**
- 1人あたりの担当ドット数がおおよそ一定（約200〜500個）になるよう調整
- ゴースト対プレイヤー比率もほぼ一定（約1:1〜1.5:1）
- エリア数は概ね `ceil(players / 3)` 程度。1エリアあたり平均3人が適正密度

### 2.3 エリアの個性

各エリアにはランダムに特性が付与される（毎ゲーム変化）。

| エリア特性 | 効果 |
|---|---|
| **通常** | 標準的な迷路。特殊効果なし |
| **狭路** | 通路幅が狭い。ゴーストとの遭遇率が高い |
| **広場** | 開けた空間が多い。視界が広い |
| **暗闘** | 視界が狭い（周囲数マスのみ表示）。緊張感が高い |
| **高速** | ゴーストの移動速度 +20% |
| **巣窟** | ゴーストのスポーン地点がある。放置すると増殖 |

**マップ中央ほど難易度が高いエリアが配置されやすい。** 外周から攻略を始め、徐々に中央に向かう自然な流れが生まれる。

### 2.4 未知のマップ（戦場の霧）

**マップはゲーム開始時に全貌が隠されている。** プレイヤーが通過した場所だけが明らかになる。

- 未探索エリアはミニマップ上で「？」と表示される
- プレイヤーが初めてエリアに入ると、そのエリアの迷路構造が全員に公開される
- ただし、ゴーストの位置やドットの残量は実際にそのエリアにいるプレイヤーにしか見えない（制覇済みエリアを除く）
- エリア特性（狭路、暗闘など）はエリアに入って初めて判明する

**設計意図:**
- 「あの先に何があるんだろう」という探索の楽しさを生む
- 偵察役として先行するプレイヤーの価値が生まれる
- 毎ゲーム異なるマップ × 未知の状態 = リプレイ性の向上
- 最初から全体が見えないことで、100人でも序盤に情報過多にならない

### 2.5 ゲート（複数人必須ギミック）

一部のエリア間通路には **ゲート** が設置される。ゲートを開くには、同時に複数のスイッチ（通路の両側に配置）を踏む必要がある。最低2人の協力が必要。

ゲートの存在は、少人数プレイでは減少し、大人数プレイでは増加する。

---

## 3. プレイヤー

### 3.1 基本操作

- 移動: 上下左右（キーボード / スワイプ / バーチャルパッド）
- 特殊操作なし。Pac-Man のシンプルさを維持する。

### 3.2 プレイヤーの状態

| 状態 | 説明 |
|---|---|
| **通常** | ドットを食べられる。ゴーストに触れるとやられる |
| **パワー** | パワーエサ取得 or 覚醒発動後の一定時間。ゴーストを食べられる |
| **ダウン** | ゴーストにやられた状態。その場で停止。半透明で表示される |
| **AI代行** | プレイヤーが切断した場合。AIが操作を引き継ぐ |

### 3.3 ダウンと救出

- ゴーストに触れるとその場で **ダウン状態** になる
- ダウン中は操作不能。位置はマップ上に表示される（救難信号アイコン）
- **他のプレイヤーがダウン地点に到達すると即座に復活**（覚醒ゲージ・ストックは全て維持）
- 一定時間（30秒）救出されないと、最寄りの **制覇済みエリアのリスポーン地点** から自動復活
- **自動復活のペナルティ: 覚醒ゲージがリセットされ、ストックが1つ失われる**（0個なら0のまま）

**設計意図:**
- 救出されるか自動復活かで明確な差がある → 「助けに行く価値」が高まる
- ダウンした側も「誰か来てくれ！」という切実さが生まれる
- ストック3個満タンで前線にいるプレイヤーほどダウンのリスクが大きい → 慎重なプレイが報われる
- 一方でペナルティは壊滅的ではない（ストック1個 + ゲージのみ）ので、自動復活しても十分リカバリー可能
- 終盤のボス戦前にストックを溜めたプレイヤーがダウンする → 「あの人を助けに行かないとストックが無駄になる！」という自然なドラマが生まれる

### 3.4 途中離脱とAI代行

- プレイヤーが切断（ブラウザを閉じる、通信断など）した場合、**AIが即座に操作を引き継ぐ**
- AI代行キャラは見た目が少し変化（半透明 or アイコンにロボットマーク）
- AI代行の行動: 近くのドットを食べに行く、ゴーストから逃げる、パワーエサがあれば取る（覚醒ストックは使わない）
- AI代行は「そこそこ有能だが最適ではない」程度の強さ。人間プレイヤーより劣るがいないよりはマシ
- 切断したプレイヤーが再接続した場合、同じキャラを引き継いで操作を再開できる（覚醒ストックも維持）
- **途中参加は認めない**（ゲームバランスが動的に変わることを防ぐため。代わりにAI代行が穴を埋める）

---

## 4. ゴースト

### 4.1 ゴーストの種類

| 種類 | 行動パターン | 登場時期 |
|---|---|---|
| **ランダム（赤）** | ランダム移動。交差点で適当に曲がる | 序盤〜 |
| **追跡（ピンク）** | 最寄りのプレイヤーを追いかける | 序盤〜 |
| **巡回（水色）** | 特定エリア内を巡回する | 中盤〜 |
| **挟撃（オレンジ）** | プレイヤーの先回りを狙う。2体以上で挟み撃ち | 中盤〜 |
| **侵攻（紫）** | 制覇済みエリアに積極的に侵入し、ドットを再生成する | 終盤〜 |
| **ボス（黒）** | 大型。パワー/覚醒1回につき1ヒットしか入らない（後述） | 最終盤 |

### 4.2 ゴーストの動的スケーリング

ゴーストもプレイヤー数に連動してスケールする。

**基本方針:**
- ゴースト総数 ≒ `プレイヤー数 × 1.0〜1.5`（制覇率に応じて変動）
- ゴーストの種類分布も制覇率に応じて変化

```
制覇率に応じたゴースト構成の変化:

  0%   ████████░░░░░░░░░░░░  ランダム80% / 追跡20%
 30%   ██████░░░░████░░░░░░  ランダム40% / 追跡30% / 巡回20% / 挟撃10%
 60%   ████░░░░████░░██░░░░  ランダム20% / 追跡20% / 巡回20% / 挟撃20% / 侵攻20%
 90%   ██░░░░██░░████░░████  ランダム10% / 追跡15% / 挟撃25% / 侵攻30% / ボス20%
```

### 4.3 ゴーストの強さのスケーリング（プレイヤー数別）

少人数プレイで理不尽にならないよう、ゴーストの「質」も調整する。

- **少人数（2〜5人）:** ゴーストの移動速度がやや遅い。挟撃ゴーストの連携精度が低い
- **中人数（6〜30人）:** 標準バランス
- **大人数（31〜100人）:** ゴーストの移動速度がやや速い。侵攻ゴーストの出現が早い

---

## 5. エリア制覇と維持 — コアメカニクス

### 5.1 制覇条件

エリア内の **全ドットを食べきる** とそのエリアは **制覇状態** になる。

制覇時の演出:
- エリア全体が一瞬光る
- 制覇サウンドが全プレイヤーに聞こえる（距離に応じて音量減衰）
- ミニマップ上でエリアの色が変わる

### 5.2 制覇エリアの恩恵

| 恩恵 | 効果 |
|---|---|
| **移動速度 UP** | 制覇エリア内ではプレイヤーの移動速度が 1.2倍 |
| **ミニマップ情報** | 制覇エリア内のゴースト位置がミニマップに表示される |
| **リスポーン地点** | ダウン後の自動復活地点になる |
| **ゴースト排除** | 制覇直後、エリア内のゴーストが一掃される |

### 5.3 ドット再生成（劣化メカニクス）

**制覇エリアは時間経過でドットが再生成される。** 完全に放置すると未制覇状態に戻る。

再生成の仕組み:
- 制覇後、一定時間（猶予期間）はドットが再生成されない
- 猶予期間後、ドットがゆっくりと再出現し始める
- 再出現ドットが一定割合を超えると、制覇状態が解除される

### 5.4 維持コストの非線形増大（終盤緊張感の核心）

**全体制覇率が高いほど、ドット再生成速度が加速する。**

| 全体制覇率 | 猶予期間 | 再生成速度（倍率） | 体感 |
|:---:|:---:|:---:|---|
| 0〜30% | 120秒 | ×1.0 | 余裕がある。探索を楽しめる |
| 31〜50% | 90秒 | ×1.3 | そろそろ後方も気になる |
| 51〜70% | 60秒 | ×1.8 | 防衛と攻略の両立が必要 |
| 71〜85% | 40秒 | ×2.5 | かなりシビア。全員フル稼働 |
| 86〜95% | 25秒 | ×3.5 | 総力戦。ギリギリの攻防 |
| 96〜100% | 15秒 | ×5.0 | クライマックス。一瞬の油断が崩壊を招く |

**侵攻ゴースト（紫）** はこの再生成を加速させる。侵攻ゴーストが制覇済みエリアに侵入すると、そのエリアの再生成速度がさらに上がる。侵攻ゴーストを排除すれば通常速度に戻る。

**設計意図:**
- 信長の野望問題の回避 → 領土が広いこと自体がコスト
- 桃鉄問題の回避 → ランダムイベントではなく、予測可能な圧力増大
- 100%制覇の瞬間が「全員でギリギリ達成した」感覚になる

---

## 6. ドット・パワーエサ・覚醒・アイテム

### 6.1 通常ドットと覚醒ゲージ

通常ドットは単なるクリア条件ではなく、**プレイヤーの戦闘力に直結するリソース**。

**覚醒ゲージ:**
- ドットを食べるとゲージが溜まる
- **N個（50個）** 食べるとゲージが満タンになり、**覚醒ストック** が1つ貯まる
- ストックは最大 **k個（3個）** まで保持可能
- ストックはプレイヤーが **任意のタイミングで発動** できる（スペシャルウェポン的な位置づけ）

**覚醒発動時の効果:**
- パワーエサと同等の効果（ゴーストを食べられる状態）
- 効果時間: 6秒（パワーエサの8秒よりやや短い）
- パワーエサと同様、周囲の味方にも効果が波及する
- **ボスゴーストへのダメージにもカウントされる**（ただしヒット時にパワー/覚醒状態は消費される）

**設計意図:**
- 「ドットを食べる」というPac-Manの最も基本的な行動に、エリア制覇以外の報酬を与える
- ボス戦でパワーエサの位置に依存しなくても、ドットを地道に食べた蓄積で戦える
- 「ストックを温存するか、今使うか」という判断が戦略性を生む
- 終盤、制覇済みエリアの防衛で再生成ドットを食べ直す行為にも意味が生まれる（ストック補充になる）

```
覚醒ゲージの表示イメージ:

  ドット: ●●●●●●●●●●●●●●●○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○ (30/50)
  ストック: [★][★][☆]  ← 2個保持中、あと1枠空き
```

### 6.2 パワーエサ

- 取得したプレイヤーを中心に **半径 N マスの範囲にいる味方全員** がパワー状態になる
- 効果時間: 8秒（プレイヤー数が多いほど少し短くなる）
- パワー状態中はゴーストを食べられる
- **ボスゴーストにはパワーエサ / 覚醒 合計3回分のダメージが必要**

**ボスゴースト戦の特殊ルール:**
- ボスゴーストにヒットした瞬間、**そのプレイヤーのパワー/覚醒状態が即座に消費される**
- つまり1回のパワー/覚醒状態でボスに与えられるダメージは1ヒットのみ
- 通常ゴーストには従来通り、パワー/覚醒状態中に何体でも食べられる（ボス専用ルール）
- ヒット後、ボスは数秒間ノックバック（後退）して距離を取る
- ボスの残りHP（残りヒット数）は頭上に表示される

**想定される攻略パターン:**
- **3人同時突撃:** 3人がそれぞれ覚醒を発動し、同時にボスにぶつかって一気に撃破（理想形）
- **リレー式:** 1人目がパワーエサで1ヒット → ボスがノックバックして戻ってくる間に2人目が覚醒で1ヒット → 3人目が仕上げ
- **ソロ持久戦:** 1人がストック3個で挑む。1ヒット → ノックバック待ち → 2ヒット目 → 待ち → 3ヒット目（時間はかかるが可能）

**パワーエサの再出現:**
- パワーエサは取得後、同じ位置に一定時間後に再出現する
- 再出現時間: **90秒**（固定）
- 再出現時にはエリア内の全プレイヤーに短い通知音が鳴る
- 制覇済みエリアのパワーエサも再出現する（防衛の重要な武器になる）

**パワーエサと覚醒の使い分け:**

| | パワーエサ | 覚醒 |
|---|---|---|
| 入手方法 | マップ上の固定位置で取得 | ドット50個食べて1ストック |
| 発動タイミング | 取得と同時（即時） | 任意（ストックから選択発動） |
| 効果時間 | 8秒 | 6秒 |
| 周囲への波及 | あり | あり |
| 戦略的価値 | 位置が分かるので集合の目印になる | 任意タイミングなので奇襲・緊急対応に強い |

### 6.3 フルーツ（一時バフ）

ラウンド中にランダムでマップ上に出現。取得すると一時的なバフを得る。

| フルーツ | 効果 | 持続時間 |
|---|---|---|
| 🍒 チェリー | 移動速度 +30% | 10秒 |
| 🍓 ストロベリー | パワーエサ / 覚醒の効果範囲 2倍 | 次の発動時 |
| 🍊 オレンジ | 周囲のゴーストを一定時間スタン | 即時（5秒間） |
| 🍎 アップル | ダウン中の味方を遠隔復活（マップ全体） | 即時 |
| 🔑 キー | 最寄りのゲートを単独で開放可能 | 即時 |
| 🍇 グレープ | 覚醒ゲージ即時満タン（ストック+1） | 即時 |

### 6.4 アイテム出現頻度のスケーリング

- 少人数時: フルーツ出現頻度がやや高い（個人の選択肢を増やし、少人数の不利を補う）
- 大人数時: フルーツ出現頻度がやや低い（人数の利を活かした協力で補う前提）

---

## 7. ゲーム進行と勝利条件

### 7.1 ゲームの流れ

```
[ロビー] → [マッチング / マップ生成] → [ゲーム開始] → [クリア or 全滅]

ゲーム中のフェーズ:

  序盤（制覇 0〜30%） ──── 探索フェーズ
  │  プレイヤーは散開してドットを食べる
  │  ゴーストは弱い。マップを覚える時間
  │
  中盤（制覇 30〜70%）──── 戦略フェーズ
  │  維持コスト増加。どこを優先するか判断が必要
  │  ゴーストが賢くなる。前線での協力が重要に
  │  ゲートの先のエリアに進出開始
  │
  終盤（制覇 70〜90%）──── 攻防フェーズ
  │  維持がきつい。防衛と攻撃の配分がシビア
  │  侵攻ゴースト出現。後方も油断できない
  │
  最終盤（制覇 90〜100%）── 総力戦フェーズ
     最後のエリアにボスゴースト
     全体が崩壊するリスクと隣り合わせ
     100%達成 → 全員でクリア！
```

### 7.2 勝利条件

**全エリア制覇（全ドット消化）を同時に達成した瞬間、ゲームクリア。**

「同時に」がポイント。再生成があるため、全エリアが同時に制覇状態であることが条件。つまり最後の1エリアを制覇する前に、他のエリアが劣化して未制覇に戻っていたら勝利にならない。

### 7.3 敗北条件

以下のいずれかで敗北:

- **制限時間切れ:** ゲーム開始から一定時間（プレイヤー数に応じて調整、目安15〜30分）が経過
- **全滅:** 全プレイヤーが同時にダウン状態になる（誰も救出できない状態）
- **崩壊:** 制覇率が一度70%を超えた後、30%以下に落ちる（壊滅的な巻き返しが起きた場合のみ）

### 7.4 難易度設定

ロビーのホストが難易度を選択可能。ゴーストのパラメータと維持コスト倍率を一括調整。

| 難易度 | ゴースト速度 | 維持コスト | 想定クリア率 |
|:---:|:---:|:---:|:---:|
| カジュアル | ×0.8 | ×0.6 | 80%+ |
| ノーマル | ×1.0 | ×1.0 | 50% |
| ハード | ×1.2 | ×1.4 | 20% |
| ナイトメア | ×1.5 | ×2.0 | 5% |

---

## 8. UI / HUD

### 8.1 メイン画面

```
┌─────────────────────────────────────────────┐
│ [ミニマップ]              [制覇率 67%]  [残り時間 12:34] │
│ ┌──────┐                                    │
│ │ ■□□■ │                                    │
│ │ □■■□ │   ┌─────────────────────┐          │
│ │ ■□■□ │   │                     │          │
│ └──────┘   │     メインビュー     │          │
│             │   (自分の周辺拡大)   │          │
│             │                     │          │
│             └─────────────────────┘          │
│                                              │
│ [覚醒 ★★☆ ▓▓▓▓▓▓▓░░░ 35/50]                │
│ [救難信号: 2人ダウン中 →方向 ★★★/★☆☆]  [現エリア進捗 78%] │
└─────────────────────────────────────────────┘
```

### 8.2 ミニマップの情報

| 表示 | 色 / アイコン |
|---|---|
| 制覇済みエリア | 明るい青 |
| 未制覇エリア | 暗いグレー |
| 劣化中エリア（ドット再生中） | 黄色点滅 |
| 自分の位置 | 白い丸 |
| 他プレイヤー | 小さな黄色い丸 |
| ダウン中プレイヤー | 赤い点滅 + 覚醒ストック数表示（★の数） |
| ゴースト（制覇エリア内のみ） | 赤い小さな点 |
| ボスゴースト | 大きな赤い点 |
| ゲート（未開放） | 鍵アイコン |

### 8.3 コミュニケーション

テキストチャットは不要（100人では機能しない）。代わりに:

- **ピンシステム:** マップ上に「ここに集合」「危険」「この方向へ」のピンを打てる（クールダウンあり）
- **自動シグナル:** ダウン時、パワーエサ取得時に自動で周囲に通知
- **エリア状態アラート:** 制覇済みエリアが劣化し始めると、そのエリア付近のプレイヤーに警告

---

## 9. リプレイとゲームタイムライン

### 9.1 リプレイ機能

ゲーム終了後、全プレイヤーに **マップ全体のタイムラプスリプレイ** が再生される。

**リプレイの内容:**
- マップ全体を俯瞰した視点で、ゲーム開始から終了までを高速再生（30秒〜1分程度）
- プレイヤーの動きが光の粒として表示される
- 制覇されたエリアが色で塗り替わっていく様子が見える（スプラトゥーン的な快感）
- ゴーストの侵攻と防衛の攻防が視覚的に分かる
- ボスゴースト撃破の瞬間はスローモーション演出

### 9.2 ゲームタイムライン（シヴィライゼーション風）

リプレイ画面の下部に、ゲーム全体の進行をタイムラインで表示する。

```
タイムラインのイメージ:

  0:00              5:00             10:00            15:00      20:00
  ├────────┼──────────┼─────────────────┼────────────────┤
  │        │          │                 │                │
  ▼        ▼          ▼                 ▼                ▼
  開始   エリアB制覇   制覇率50%到達     ボスゴースト出現   クリア！
         初の制覇！    挟撃ゴースト登場   制覇率一時78%→65%  制覇率100%
                                       に後退（大侵攻）

  制覇率グラフ:
  100%|                                              ╱
   80%|                                    ╱╲      ╱
   60%|                              ╱╱╱╱    ╲  ╱
   40%|                    ╱╱╱╱╱╱╱
   20%|          ╱╱╱╱╱╱╱╱
    0%|╱╱╱╱╱╱╱╱
      └──────────────────────────────────────────────
```

**タイムラインに記録されるイベント:**
- 各エリアの初制覇時刻
- 制覇率のマイルストーン（25%, 50%, 75%, 90%）
- ボスゴースト出現 / 撃破
- 制覇率が大きく後退した瞬間（大侵攻）
- 全滅危機（残りアクティブプレイヤー3人以下になった瞬間）
- ゲームの勝敗

### 9.3 個人戦績サマリー

タイムラインと合わせて、個人の貢献が時系列で表示される。

- 自分がどのエリアをいつ制覇したか
- 自分の覚醒発動タイミングとその効果（ゴースト撃破数）
- 救出した / された回数と場所
- 「あなたのハイライト」: 最も活躍した瞬間のリプレイをピックアップ

---

## 10. スコアリングと表彰

### 10.1 ゲーム中スコア（個人）

| 行動 | スコア |
|---|---|
| ドット1個食べる | 10 pt |
| ゴースト1体食べる（パワーエサ） | 100 pt |
| ゴースト1体食べる（覚醒） | 120 pt |
| ボスゴースト撃破（貢献） | 500 pt |
| 味方を救出 | 200 pt（+ 救出相手のストック数 × 50 pt） |
| エリア制覇時にそのエリアにいた | 300 pt |
| 劣化エリアの再制覇 | 400 pt |
| エリア初探索（最初に未知エリアに踏み入れた） | 150 pt |

### 10.2 ゲーム終了時の表彰

| 称号 | 条件 |
|---|---|
| 🏆 MVP | 総合スコア1位 |
| 🍽️ 大食い王 | ドット消化数1位 |
| 👻 ゴーストハンター | ゴースト撃破数1位 |
| 🛡️ 守護者 | 劣化エリアの再制覇回数1位 |
| 🚑 救急隊長 | 味方救出数1位 |
| 🗺️ 開拓者 | 未知エリアを最初に探索した回数1位 |
| ⚡ 覚醒マスター | 覚醒発動によるゴースト撃破数1位 |
| 🌍 皆勤賞 | 全エリアでドットを食べた |

---

## 11. 技術設計（概要）

### 11.1 アーキテクチャ

```
クライアント（ブラウザ）
  │  WebSocket
  ▼
ゲームサーバー（権威サーバーモデル）
  │
  ├─ ゲームロジック（ティックレート: 20Hz）
  ├─ 空間分割（エリア単位で処理を分散）
  └─ マッチメイキング / ロビー管理
```

### 11.2 ネットワーク最適化

- **関心領域（Area of Interest）:** クライアントには自分の周辺エリア＋隣接エリアの情報のみ送信
- **エリア単位の状態管理:** 各エリアのドット状態は圧縮ビットマップで管理
- **入力の最小化:** クライアントからサーバーへは「方向変更」イベントのみ送信
- **補間と予測:** クライアント側でプレイヤー移動を予測描画し、遅延を隠蔽

### 11.3 プレイヤー数に応じた動的生成

```
マッチ開始時の処理:

  1. プレイヤー数を確定
  2. エリア数を算出: ceil(players / 3)
  3. マップテンプレートからエリア配置を選択
  4. 各エリアの迷路をプロシージャル生成
  5. エリア特性をランダム付与
  6. ゴースト初期配置を決定
  7. パワーエサ / フルーツの配置を決定
  8. ゲート配置を決定（プレイヤー数に応じて数を調整）
  9. 難易度パラメータを適用
  10. 全プレイヤーに開始エリア（外周）をランダム割当
```

### 11.4 サーバーティック処理（1ティック = 50ms）

```
each tick:
  1. クライアント入力を適用（方向変更、覚醒発動）
  2. 全プレイヤー移動処理（AI代行プレイヤー含む）
  3. 全ゴースト AI 更新 & 移動処理
  4. 衝突判定
     - プレイヤー × ドット → ドット消化 + 覚醒ゲージ更新
     - プレイヤー × ゴースト → ダウン or ゴースト撃破（パワー / 覚醒状態時）
     - プレイヤー × ダウン中プレイヤー → 救出
     - プレイヤー × パワーエサ → パワー状態（周囲波及）
     - プレイヤー × フルーツ → バフ適用
     - プレイヤー × スイッチ → ゲート判定
  5. エリア制覇判定
  6. 戦場の霧更新（プレイヤーが新エリアに入ったら全員に公開）
  7. ドット再生成処理（制覇済みエリア、ティック毎に確率判定）
  8. パワーエサ再出現判定（取得後90秒経過チェック）
  9. ゴースト増殖 / 種類変更判定
  10. 勝利 / 敗北判定
  11. タイムラインイベント記録
  12. 各クライアントに差分状態を送信
```

---

## 12. バランス調整の指針

### 12.1 スケーリングで変わるもの

| パラメータ | 少人数（2〜5人） | 大人数（61〜100人） |
|---|---|---|
| マップ面積 | 小 | 大 |
| 1人あたり担当ドット | 約300 | 約200 |
| ゴースト数 | 少 | 多 |
| ゴーストの賢さ | やや低い | やや高い |
| フルーツ出現率 | やや高い | やや低い |
| ゲート数 | 少ない | 多い |
| パワーエサ効果範囲 | 広い | 標準 |
| パワーエサ効果時間 | やや長い | やや短い |
| 覚醒に必要なドット数 | 40個 | 50個 |
| 覚醒最大ストック | 3個 | 3個 |
| 制限時間 | 15分 | 30分 |

### 12.2 スケーリングで変わらないもの

以下は人数に関わらず一定に保つ。ゲーム体験の一貫性を担保するため。

- プレイヤーの移動速度
- ゴーストの基本移動速度（難易度設定による変化はあり）
- 制覇エリアの恩恵内容
- 維持コストの非線形カーブ形状（倍率の数値は難易度に依存）
- 救出メカニクスのルール
- 覚醒の最大ストック数（3個）
- 覚醒の効果時間（6秒）
- パワーエサの再出現間隔（90秒）
- 勝利 / 敗北条件のロジック

### 12.3 テストすべきバランスポイント

- [ ] 5人でクリア可能か（カジュアル難易度）
- [ ] 100人でも終盤に緊張感があるか（ノーマル難易度）
- [ ] 維持コストカーブが急すぎて90%から先に進めない状況にならないか
- [ ] 少人数でボスゴースト撃破が現実的か（覚醒ストック3回の蓄積で対応可能か）
- [ ] フルーツの「アップル（遠隔復活）」が少人数プレイで必須すぎないか
- [ ] ゲーム時間が目標範囲（15〜30分）に収まるか
- [ ] 覚醒ゲージの必要ドット数（50個）が多すぎ / 少なすぎないか
- [ ] パワーエサの再出現間隔（90秒）が適切か
- [ ] AI代行プレイヤーが強すぎて人間不要にならないか
- [ ] AI代行プレイヤーが弱すぎて離脱発生時にゲーム崩壊しないか
- [ ] 戦場の霧が序盤の探索を面白くしているか、ストレスになっていないか
- [ ] 自動復活のストック喪失ペナルティが重すぎないか（特に少人数で救出が間に合いにくい場合）

---

## 13. 今後検討が必要な項目

- **シーズン / ランキング:** 継続プレイのモチベーション設計。週間ランキング、シーズン報酬など
- **モバイル操作の最適化:** スワイプ vs バーチャルパッドの検証。覚醒発動ボタンの配置
- **アクセシビリティ:** 色覚対応（ゴースト種類を色以外でも識別可能に）、サウンドキュー
- **リプレイの共有:** タイムラプスリプレイを動画 or URLとして共有できる仕組み
- **観戦モード:** ゲーム中にマップ全体を俯瞰で観戦できるモード（配信向け）
- **カスタムマッチ:** ホストがパラメータ（覚醒必要ドット数、維持コスト倍率など）を細かく調整可能に
- **サウンドデザイン:** エリア制覇音、覚醒発動音、ボスゴースト登場BGMなどの設計