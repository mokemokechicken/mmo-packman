# MVP仕様と実装状況

## ゴール

- Webブラウザで実際に遊べる状態を最優先に実装
- サーバー権威モデルで同期プレイ可能にする
- 高可用性・永続化は後回し

## 今回実装した内容

### サーバー

- TypeScript + Node.js + WebSocket (`ws`) + Express
- 20Hz ティックでゲーム進行
- ロビー機能
  - 名前入力
  - ホストによる開始
  - 難易度選択（Casual/Normal/Hard/Nightmare）
  - AIプレイヤー人数指定（0〜100）
  - テスト時間指定（1〜10分）
- 観戦モード
  - 進行中でも新規観戦参加可能
  - プレイヤー参加/観戦参加の切り替え
- 再接続機能
  - リコネクトトークンで同一メンバー復帰
- 切断時 AI 代行

### ワールド / ルール

- プレイヤー人数に応じたエリア数・マップサイズスケーリング
- エリア特性（normal/narrow/plaza/dark/fast/nest）
- ドット消化とエリア制覇
- 制覇後のドット再生成と制覇解除
- 制覇率に応じた再生成圧の上昇（終盤圧力）
- ゲート（両側スイッチ同時踏みで開く）
- パワーエサ取得 + 周囲波及
- 覚醒（ドット50個でストック、任意発動）
- ダウン / 救出 / 自動復活（ストック減少ペナルティ）
- フルーツ6種（cherry/strawberry/orange/apple/key/grape）
- ゴースト6種（random/chaser/patrol/pincer/invader/boss）
- 勝敗条件
  - 勝利: 全エリア同時制覇
  - 敗北: 時間切れ / 全滅 / 崩壊

### AI挙動（強化版）

- 危険時の逃走優先
- ダウン中味方の救助優先
- パワーエサ回収優先（脅威時）
- 制覇済みエリア劣化の防衛優先
- 未探索エリア探索
- 閉鎖ゲートのスイッチ補助
- 覚醒の自動発動（近接脅威/ボス近接時）

### クライアント

- TypeScript + Vite + Canvas 2D
- キーボード操作
  - `Arrow` / `WASD`: 移動
  - `Space` / `E` / `Enter`: 覚醒
- モバイル向け簡易タッチUI
- HUD（制覇率、残り時間、覚醒、イベントログ）
- ロビー画面 / リザルト画面
- 観戦カメラ
  - 自動追従（スコア上位生存プレイヤー）
  - `Tab` で追従対象切り替え

### テストプレイ支援

- `npm run simulate` で AI-only シナリオ検証
  - `AI x2`（短時間の動作確認）
  - `AI x5`（バランス初期確認）
- 異常検知（NaN座標、不正ステータスなど）

## 未実装（次フェーズ）

- AOI差分同期（現在は簡易全体同期）
- リプレイタイムラプス
- ピンシステム
- 詳細な表彰ロジック
- 観戦UIの高度化（自由カメラ、ミニマップ俯瞰）
- 永続ランキング
- サウンド

## 設計ドキュメントとの差分方針

`docs/game_design.md` は最終形に近い仕様です。MVPでは以下を優先しました。

- 遊べること
- コアループ（探索→制覇→維持→終盤圧力）が成立すること
- 将来拡張しやすいデータ構造にしておくこと
